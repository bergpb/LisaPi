{% extends 'base.html' %}
{% block title %}{{ super() }}| Index{% endblock %}}
{% block page %} Home {% endblock %}}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col s12 m12 l12 center-align mt2">
      {% if current_user.id %}
        <div id="app" v-cloak>
          <div v-if="loading" class="col s12 m12 l12 center-align mt4">
            <i class="fas fa-sync-alt fa-spin fa-4x"></i>
          </div>
          <div v-else>
            <div class="col s12 m6 l6 x6">
              <div class="widget-min teal">
                <div class="row">
                  <div style="margin-top: 0.7em" class="col s1 m1 l1">
                    <i class="fas fa-microchip fa-2x left-align" style="color: white"></i>
                  </div>
                  <div class="col s11 m11 l11">
                    <p class="right-align white-text">
                      <strong>Process: ${ status.process }</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l6 x6">
              <div 
                v-bind:class="{ 'teal': (status.cpu_temp <= 50),
                                'amber darken-4': (status.cpu_temp > 50 && status.cpu_temp <= 60),
                                'red accent-4': (status.cpu_temp > 60) }"
                class="widget-min"
              >
                <div class="row">
                  <div style="margin-top: 0.7em" class="col s1 m1 l1">
                    <i class="fas fa-thermometer-half fa-2x" style="color: white; margin-left: -5px"></i>
                  </div>
                  <div class="col s11 m11 l11">
                    <p class="right-align white-text">
                      <strong>CPU Temp: ${ status.cpu_temp }ยบ</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l6 x6">
              <div class="widget-min teal">
                <div class="row">
                  <div style="margin-top: 0.7em" class="col s1 m1 l1">
                    <i class="fas fa-clock fa-2x" style="color: white; margin-left: -5px"></i>
                  </div>
                  <div class="col s11 m11 l11">
                    <p class="right-align white-text">
                      <strong>Uptime: ${ status.uptime }</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l6 x6">
              <div class="widget-min teal">
                <div class="row">
                  <div style="margin-top: 0.7em" class="col s1 m1 l1">
                    <i class="fas fa-memory fa-2x" style="color: white; margin-left: -5px"></i>
                  </div>
                  <div class="col s11 m11 l11">
                    <p class="right-align white-text">
                      <strong>Memory Used / Free: ${ status.mem_used } Mb / ${ status.mem_free } Mb</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l6 x6">
              <div class="widget-min teal">
                <div class="row">
                  <div style="margin-top: 0.7em" class="col s1 m1 l1">
                    <i class="fas fa-hdd fa-2x" style="color: white; margin-left: -5px"></i>
                  </div>
                  <div class="col s11 m11 l11">
                    <p class="right-align white-text">
                      <strong>SdCard Used / Free: ${ status.sdcard_used } Gb / ${ status.sdcard_free } Gb</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l6 x6">
              <div class="widget-min teal">
                <div class="row">
                  <div style="margin-top: 0.7em" class="col s1 m1 l1">
                    <i class="fas fa-laptop fa-2x" style="color: white; margin-left: -5px"></i>
                  </div>
                  <div class="col s11 m11 l11">
                    <p class="right-align white-text">
                      <strong>Ip Adress: ${ status.ip_external }</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% else %}
      <div class="col s12 m12 l12 center-align mt1">
        <p>Hello, please login.</p>
        <a class="btn" href="{{ url_for('login') }}">Login</a>
      </div>
      {% endif %}
    </div>
  </div>
</div>
<script type="text/javascript">
  var socket = io.connect('http://' + document.domain + ':' + location.port + '/sockets');
  var app = new Vue({
      el: "#app",
      delimiters: ['${', '}'],
      data: {
        status: '',
        loading: true
      },
  });
  socket.on('connect', function() {
    console.log('Websocket connected!');
  });
  function updateValues() {
    socket.emit('updateStatus', {});
  }

  socket.on('statusUpdated', function(data) {
    app.$set(app, 'status', data);
    app.$set(app, 'loading', false);
  });

  updateValues();
  setInterval(function(){ updateValues(); }, 2000);
</script>
{% endblock %}
